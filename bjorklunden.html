<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seasons</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="seasons.css">
</head>
<body>
<div class="header"><a href="//folkol.com">folkol.com</a></div>
<div class=content>
    <div id="box">
        <svg id="playbutton" height="300" width="400" style="background-color:transparent">
            <polygon
                    points="40,40 360,40 360,260 40,260"
                    style="opacity: 0.8; stroke: rgb(230, 230, 230); fill: rgb(230, 230, 230); stroke-width: 80; stroke-linejoin: round;"/>
            <polygon
                    points="120,80 310,150 120,220"
                    style="stroke: #717171; fill: gray; stroke-width: 10; stroke-linejoin: round;"/>
        </svg>
        <div id=gallery>
            <img src="seasons-4868-1.jpg" class="picture">
        </div>
        <div class="slidecontainer">
            <input type="range" min="1" max="52" value="0" class="slider" id="slider">
        </div>
        <span id="progress" class="hidden"></span>
    </div>
</div>
</body>
<script type="text/javascript">
    // todo: maybe swipe on image?
    // todo: add date information, somehow
    let slider = document.getElementById("slider");
    let output = document.getElementById("gallery");
    let progress = document.getElementById("progress");
    let playbutton = document.getElementById("playbutton");

    let imageNames = [
        "seasons-4868-1.jpg",
        "seasons-4868-2.jpg",
        "seasons-4868-3.jpg",
        "seasons-4868-4.jpg",
        "seasons-4868-5.jpg",
        "seasons-4868-6.jpg",
        "seasons-4868-7.jpg",
        "seasons-4868-8.jpg",
        "seasons-4868-9.jpg",
        "seasons-4868-10.jpg",
        "seasons-4868-11.jpg",
        "seasons-4868-12.jpg",
        "seasons-4868-13.jpg",
        "seasons-4868-14.jpg",
        "seasons-4868-15.jpg",
        "seasons-4868-16.jpg",
        "seasons-4868-17.jpg",
        "seasons-4868-18.jpg",
        "seasons-4868-19.jpg",
        "seasons-4868-20.jpg",
        "seasons-4868-21.jpg",
        "seasons-4868-22.jpg",
        "seasons-4868-23.jpg",
        "seasons-4868-24.jpg",
        "seasons-4868-25.jpg",
        "seasons-4868-26.jpg",
        "seasons-4868-27.jpg",
        "seasons-4868-28.jpg",
        "seasons-4868-29.jpg",
        "seasons-4868-30.jpg",
        "seasons-4868-31.jpg",
        "seasons-4868-32.jpg",
        "seasons-4868-33.jpg",
        "seasons-4868-34.jpg",
        "seasons-4868-35.jpg",
        "seasons-4868-36.jpg",
        "seasons-4868-37.jpg",
        "seasons-4868-38.jpg",
        "seasons-4868-39.jpg",
        "seasons-4868-40.jpg",
        "seasons-4868-41.jpg",
        "seasons-4868-42.jpg",
        "seasons-4868-43.jpg",
        "seasons-4868-44.jpg",
        "seasons-4868-45.jpg",
        "seasons-4868-46.jpg",
        "seasons-4868-47.jpg",
        "seasons-4868-48.jpg",
        "seasons-4868-49.jpg",
        "seasons-4868-50.jpg",
        "seasons-4868-51.jpg",
        "seasons-4868-52.jpg",
    ];

    let animation = false;
    let interval = 0;

    // When dragging the slider
    slider.oninput = function () {
        playbutton.classList.add('fade-out');
        clearInterval(interval);
        let image = images[this.value - 1];
        output.innerHTML = '';
        output.appendChild(image);
        animation = false;
    };

    function toggleAnimation() {
        playbutton.classList.add('fade-out');
        clearInterval(interval);

        function pushImage(next) {
            let image = images[next - 1];
            image.classList.remove('fade-in');
            image.style.opacity = 0;
            output.appendChild(image)
            if (output.children.length > 2) {
                output.removeChild(output.firstChild);
            }
            // https://gist.github.com/paulirish/5d52fb081b3570c81e3a
            image.getBoundingClientRect()
            image.classList.add('fade-in');
            image.style.opacity = 1;
        }

        function getNext() {
            let current = parseInt(slider.value);
            let next = current + 1;
            if (next > parseInt(slider.max)) {
                next = 1;
            }
            return next;
        }

        if (!animation) {
            animation = true;
            let next = getNext();
            pushImage(next);

            slider.value = next;
            interval = setInterval(() => {
                let next = getNext();
                pushImage(next);
                slider.value = next;
            }, 1000 / 2);
        } else {
            animation = false;
        }
    }


    function downloadImages() {
        let numFinished = 0;
        setTimeout(() => {
            // show a progress indicator in a while, in case we are still downloading
            progress.classList.remove('hidden');
        }, 500);
        return imageNames.map(name => {
            let image = new Image();
            image.src = name;
            if (image.complete) {
                numFinished++;
            } else {
                progress.innerHTML = `Loading: 0 / ${imageNames.length}...`;

                image.onload = function () {
                    numFinished++;
                    if (numFinished === imageNames.length) {
                        progress.innerHTML = ''; // clear indicator when we are done, see 'progress' above
                    } else {
                        progress.innerHTML = `Loading: ${numFinished} / ${imageNames.length}...`;
                    }
                };
            }
            image.classList.add('picture');
            return image;
        });
    }

    let images = downloadImages();

    output.addEventListener('click', toggleAnimation);
</script>
</html>
